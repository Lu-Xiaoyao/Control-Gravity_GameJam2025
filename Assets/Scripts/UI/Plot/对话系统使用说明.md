# 剧情对话系统使用说明

## 概述
这是一个完整的剧情对话管理系统，可以从CSV文件中读取对话数据，支持关卡开始时的自动对话和特定位置的触发对话。

## 系统组件

### 1. PlotManager.cs
主要的对话管理器，负责：
- 读取CSV对话文件
- 管理对话流程
- 控制游戏暂停/恢复
- 处理输入响应

### 2. DialogueTrigger.cs
对话触发器，用于在特定位置触发对话：
- 支持碰撞器触发
- 支持距离触发
- 可设置一次性触发或重复触发

## 设置步骤

### 第一步：创建UI界面
1. 在Canvas中创建一个对话面板（Panel）
2. 在面板中添加两个TextMeshPro文本组件：
   - 说话者姓名文本框
   - 对话内容文本框
3. 设置合适的字体、颜色和布局

### 第二步：设置PlotManager
1. 在场景中创建一个空物体，命名为"PlotManager"
2. 添加PlotManager脚本组件
3. 在Inspector中设置：
   - **Dialogue Panel**: 拖入对话面板
   - **Speaker Name Text**: 拖入说话者姓名文本框
   - **Dialogue Content Text**: 拖入对话内容文本框
   - **CSV File Path**: 设置为"Data/Plot.csv"
   - **Typing Speed**: 设置打字机效果速度（默认0.05）

### 第三步：设置对话触发器
1. 在需要触发对话的位置创建空物体
2. 添加DialogueTrigger脚本组件
3. 在Inspector中设置：
   - **Scene Index**: 当前关卡编号
   - **Segment Index**: 对话段落编号（0为关卡开始对话）
   - **Trigger Once**: 是否只触发一次
   - **Player Tag**: 玩家标签（默认"Player"）
   - **Use Collider**: 是否使用碰撞器触发
   - **Trigger Distance**: 距离触发范围（如果不使用碰撞器）

### 第四步：配置输入系统
确保InputActions.inputactions中已配置UI.Next动作，通常绑定到：
- 空格键
- 回车键
- 鼠标左键
- 或其他任意键

## CSV文件格式

对话数据存储在`Data/Plot.csv`文件中，格式如下：

```csv
#,1,0,
系统提示,警告！前方检测到众多星体，引力场混乱程度：无法计算。对飞船航线的影响：无法计算。请小心驾驶。,,
队友,怎么办，我们已经在这片莫名其妙的星域被困了两天了，到底什么时候才能走出去？,,
主角,我……好像可以试着去改变这些星球的引力？,,
#,1,1,
心底的梦魇,就凭你，还想做英雄？你忘了吗，人类与妖精本不应该相爱，像你这样的半妖，更是从一开始就不该存在！,,
主角,集中精神，不要胡思乱想……,,
```

### 格式说明：
- `#` 开头的行：段落分割标志
  - 第一个数字：关卡编号
  - 第二个数字：段落编号（0为关卡开始，其他为触发对话）
- 普通行：对话内容
  - 第一列：说话者姓名
  - 第二列：对话内容
  - 第三列：额外数据（可选）
- `%` 开头的行：注释，会被忽略

## 功能特性

### 1. 自动对话
- 关卡开始时自动播放segmentIndex为0的对话
- 支持打字机效果
- 按任意键继续下一句

### 2. 触发对话
- 玩家进入特定区域时触发对话
- 支持一次性触发或重复触发
- 可设置触发距离或使用碰撞器

### 3. 游戏控制
- 对话期间自动暂停游戏（Time.timeScale = 0）
- 对话结束后自动恢复游戏
- 防止对话期间的其他输入干扰

### 4. 输入响应
- 使用Unity新输入系统
- 支持UI.Next动作响应
- 打字过程中按任意键直接显示完整文本

## 使用方法

### 基本使用
1. 设置好UI界面和PlotManager
2. 在需要触发对话的位置放置DialogueTrigger
3. 编辑CSV文件添加对话内容
4. 运行游戏测试

### 高级功能
1. **动态设置场景**：调用`plotManager.SetCurrentScene(sceneIndex)`
2. **手动触发对话**：调用`plotManager.PlayDialogueSegment(sceneIndex, segmentIndex)`
3. **检查对话状态**：使用`plotManager.IsDialogueActive()`
4. **重置触发器**：调用`dialogueTrigger.ResetTrigger()`

## 注意事项

1. **文件路径**：确保CSV文件路径正确，默认在Assets/Data/Plot.csv
2. **输入系统**：确保UI.Next动作已正确配置
3. **UI组件**：确保所有UI组件引用正确设置
4. **玩家标签**：确保玩家对象有正确的Tag设置
5. **碰撞器设置**：如果使用碰撞器触发，确保碰撞器设置为Trigger

## 故障排除

### 常见问题：
1. **对话不显示**：检查UI组件引用和CSV文件路径
2. **触发器不工作**：检查玩家Tag和碰撞器设置
3. **输入无响应**：检查输入系统配置和PlotManager引用
4. **游戏不暂停**：检查Time.timeScale设置

### 调试方法：
1. 查看Console日志信息
2. 使用PlotManager的"测试对话段落"功能
3. 使用DialogueTrigger的"手动触发对话"功能
4. 检查Scene视图中的Gizmos显示

## 扩展功能

系统设计为可扩展的，你可以：
1. 添加音效支持
2. 添加角色头像显示
3. 添加对话选项系统
4. 添加对话历史记录
5. 添加多语言支持 